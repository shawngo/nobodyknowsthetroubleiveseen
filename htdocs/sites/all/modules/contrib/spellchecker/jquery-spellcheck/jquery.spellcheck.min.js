/* Copyright (c) 2010 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version 0.2
 */
(function(a){a.fn.spellcheck=function(b){return this.each(function(){var c=a(this);if(!c.is("[type=password]")&&!a(this).data("spellchecker")){a(this).data("spellchecker",new a.SpellChecker(this,b));}});};a.fn.checkspelling=function(){return this.each(function(){var b=a(this).data("spellchecker");b&&b.checkSpelling();});};a.SpellChecker=function(c,b){this.$element=a(c);this.options=a.extend({lang:"en",autocheck:750,events:"keypress blur paste",url:"spellcheck.php",ignorecaps:1,ignoredigits:1},b);this.bindEvents();};a.SpellChecker.prototype={bindEvents:function(){if(!this.options.events){return;}var b=this,c;this.$element.bind(this.options.events,function(d){if(/^key[press|up|down]/.test(d.type)){if(c){clearTimeout(c);}c=setTimeout(function(){b.checkSpelling();},b.options.autocheck);}else{b.checkSpelling();}});},checkSpelling:function(){var c=this.text,d=this.$element.val(),b=this;if(c===d){return;}this.text=this.$element.val();a.get(this.options.url,{text:this.text,lang:this.options.lang,ignorecaps:this.options.ignorecaps,ignoredigits:this.options.ignoredigits},function(e){b.parseResults(e);});},parseResults:function(c){var b=this;this.results=[];a(c).find("c").each(function(){var e=a(this),f=e.attr("o"),d=e.attr("l");b.results.push({word:b.text.substr(f,d),suggestions:e.text().split(/\s/)});});this.displayResults();},displayResults:function(){a("#spellcheckresults").remove();if(!this.results.length){return;}var h=a('<div id="spellcheckresults"></div>').appendTo("body"),e=[],j=this,c=this.$element.offset(),g=this.$element[0].offsetHeight,d,b;for(d=0;d<this.results.length;d++){var l=this.results[d],f=l.suggestions;e.push("<dl><dt>"+l.word+"</dt>");for(b=0;b<f.length;b++){e.push("<dd>"+f[b]+"</dd>");}e.push('<dd class="ignore">ignore</dd></dl>');}h.append(e.join("")).find("dd").bind("click",function(i){var m=a(this),k=m.parent();if(!m.is(".ignore")){j.$element.val(j.$element.val().replace(k.find("dt").text(),m.text()));}k.remove();if(a("#spellcheckresults").is(":empty")){a("#spellcheckresults").remove();}this.blur();}).end().css({top:c.top+g,left:c.left});}};})(jQuery);